---
title: "Time series analysis in the frequency domain"
subtitle: "FISH 507 â€“ Applied Time Series Analysis"
author: "Mark Scheuerell"
date: "28 Feb 2019"
output:
  ioslides_presentation:
    css: lecture_slides.css
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(MARSS)
set.seed(123)
```

## Topics for today

What is the frequency domain?

Fourier transforms

Spectral analysis

Wavelets


## Time domain

```{r}
par(mai = c(0.9,0.9,0.3,0.1), omi = c(0,0,0,0))

plot.ts(cumsum(rnorm(50,0,1)),
        ylab = expression(italic(x[t])))
```

We having been examining changes in $x_t$ over time


## Time domain

We can think of this as comparing changes in amplitude (displacement) with time


## Frequency domain

Today we'll consider how amplitude changes with frequency


## Jean-Baptiste Fourier (1768 - 1830)

French mathematician & physicist best known for his studies of heat transfer

First described what we now call the "greenhouse effect"


## Solving hard problems

Solving the heat equation involves solving _partial differential equations_ conditional on some boundary conditions

$$
\begin{matrix}
\large \text{Problem} \\
really \Bigg \downarrow hard \\
\large \text{Solution}
\end{matrix}
$$


## Fourier's approach

Find $f(t)$ and $\hat{f}(t)$, such that

$$
\begin{matrix}
\large \text{Problem} && \xrightarrow{f(t)} && \large \text{Transformed problem} \\
really \Bigg \downarrow hard && && much \Bigg \downarrow easier \\
\large \text{Solution}  && \xleftarrow{\hat{f}(t)} && \large \text{Transformed solution} \\
\end{matrix}
$$


## Fourier series

Complex periodic functions can be written as infinite sums of sine waves

$$
f(t) = a_0 + \sum_{k = 1}^\infty a_k \sin(2 \pi f_0 k t + p_k)
$$


## Fourier series

A finite example

$$
f(t) = \sum_{k = 1}^5 \frac{1}{k} \sin(2 \pi k t + k^2) 
$$

## Fourier series

```{r fourier_ex}
tt <- seq(-1,1,1/100)
nn <- 5

ft <- matrix(NA, nn, length(tt))

for(k in 1:nn) {
  ft[k,] <- 1/k * sin(2 * pi * k * tt + k^2)
}

par(mai = c(0.9,0.9,0.3,0.1), omi = c(0,0,0,0))

plot.ts(apply(ft, 2, sum), type = "n", las = 1,
        ylab = expression(italic(f[t])))
matlines(t(ft), lty = "solid",
        col = viridis::plasma(nn, 0.7, 0.1, 0.5))
lines(apply(ft, 2, sum), lwd = 2)
```


## Fourier series

```{r}
par(mai = c(0.9,0.9,0.3,0.1), omi = c(0,0,0,0))

plot(seq(nn), apply(ft, 1, max), type = "h", las = 1,
        ylab = "Amplitude", xlab = "Frequency")
```




## Fourier series

[animated example](https://upload.wikimedia.org/wikipedia/commons/7/72/Fourier_transform_time_and_frequency_domains_%28small%29.gif)


## Fourier transform

We can make use of Euler's formula

$$
\cos(2 \pi k) + i \sin(2 \pi k) = e^{i 2 \pi k}
$$

and write the Fourier transform of $f(t)$ as

$$
f(t) = \int_{-\infty}^\infty \hat{f}(k) ~ e^{2 \pi i t k} ~ d k
$$

where $k$ is the frequency


## Discrete Fourier transform

$$
f_k = \sum_{n=0}^{N-1} x_t ~ e^{-i 2 \pi n k}
$$


## Discrete Fourier transform

$$
f_k = \sum_{n=0}^{N-1} x_t ~ e^{-i 2 \pi n k}
$$

Inverse

$$
x_t = \frac{1}{N} \sum_{k=0}^{N-1} f_k ~ e^{i 2 \pi n k}
$$


